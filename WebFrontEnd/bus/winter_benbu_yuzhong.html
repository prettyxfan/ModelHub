<!doctype html>
<html class="no-js" lang="en" >
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>校车查询</title>
    <link rel="shortcut icon" type="image/ico" href="css/favicon.ico">
    <link rel="stylesheet" href="css/foundation.css" />
	<script src="js/vendor/modernizr.js"></script>
</head>
<body>
	<nav class="top-bar" data-topbar>
		<ul class="title-area">
			<li class="name">
				<h1><a href="#">本部到榆中</a></h1>
			</li>
		</ul>
	</nav>
	<br />
	<div class="row" id="result">
		<div class="large-12 columns"  id="con">
			<div class="row">
				<div class="large-12 columns">
					<div class="panel">
						<script type="text/javascript">
                            var path = "../logistics_data/bus_winter.xml";

                            var xmlDom = null;

                            try {
                                // IE & FireFox
                                xmlDom = document.implementation.createDocument("","",null);
                                xmlDom.async=false;
                                xmlDom.loadXML(path);
                            } catch (e) {
                                // Chrome & Safari
                                xmlhttp = new XMLHttpRequest();
                                xmlhttp.open("GET", path, false);
                                xmlhttp.send(null);
                                xmlDom = xmlhttp.responseXML;
                            }

                            x = xmlDom.getElementsByTagName("timetable");

                            var info = new Array();

                            function ergodicity( obj ){
                                if (obj.nodeType == 1) {
                                    var child = obj.childNodes;
                                    for (var i = 0; i < child.length; i++) {
                                        if(child[i].nodeName == "from"){
                                            info.push(new Array("from", child[i].childNodes[0].nodeValue));
                                            continue;
                                        }
                                        else if(child[i].nodeName == "to"){
                                            info.push(new Array("to", child[i].childNodes[0].nodeValue));
                                            continue;
                                        }
                                        else if(child[i].nodeName == "place"){
                                            info.push(new Array("place", child[i].childNodes[0].nodeValue));
                                            continue;
                                        }
                                        else if(child[i].nodeName == "meta"){
                                            var v = "";
                                            if( child[i].attributes.length != 0 ){
                                                v = child[i].childNodes[0].nodeValue + "(" + child[i].attributes[0].value + ")";
                                                info.push(new Array("meta", v));
                                            } else {
                                                info.push(new Array("meta", child[i].childNodes[0].nodeValue));
                                            }
                                            continue;
                                        }
                                        else {
                                            ergodicity(child[i]);
                                        }
                                    }
                                }
                                return;
                            }

                            ergodicity(x[0]);

                            var Benbu_Yuzhong = new Array();
                            var Yuzhong_Benbu = new Array();
                            var transition = new Array();

                            var currentKey = "";
                            var currentArray = "";
                            for(var i=0; i<info.length; i++){

                                transition = info[i];

                                if( transition[0] == "from" && transition[1] == "本部" ) {

                                    currentArray = "Benbu_Yuzhong";
                                    currentKey = "";
                                    continue;
                                }
                                else if( transition[0] == "from" && transition[1] == "榆中" ){

                                    currentArray = "Yuzhong_Benbu";
                                    currentKey = "";
                                    continue;
                                }
                                else if( transition[0] == "place" ){

                                    if( currentArray == "Benbu_Yuzhong" ){
                                        currentKey = transition[1];
                                        Benbu_Yuzhong[currentKey] = new Array();
                                    } else {
                                        currentKey = transition[1];
                                        Yuzhong_Benbu[currentKey] = new Array();
                                    }
                                }
                                else if( transition[0] == "meta" ) {

                                    if( currentArray == "Benbu_Yuzhong"){
                                        Benbu_Yuzhong[currentKey].push(transition[1]);
                                    } else {
                                        Yuzhong_Benbu[currentKey].push(transition[1]);
                                    }
                                }
                            }

							var i , j;
							for(var key in Benbu_Yuzhong){
								document.write("<h3>"+key+"</h3><hr/>");
								for(j=0;j<Benbu_Yuzhong[key].length;j++)
									document.write("<p>"+Benbu_Yuzhong[key][j]+"</p>");
								document.write("<hr/>");
							}
						</script>
						<p align="center">
							<a href="index.html" class="small button">返回</a></p>
						</div>
					</div>
				</div>
			</div>
		</div>


		<script src="js/vendor/jquery.js"></script>
		<script src="js/foundation.min.js"></script>
		<script>
			$(document).foundation();
		</script>
		
	</body>
</html>
